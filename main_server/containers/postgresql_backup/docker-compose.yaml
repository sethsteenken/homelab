version: "3.6"
services:
  postgresql_backup:
    cap_drop:
      - "AUDIT_CONTROL"
      - "BLOCK_SUSPEND"
      - "DAC_READ_SEARCH"
      - "IPC_LOCK"
      - "IPC_OWNER"
      - "LEASE"
      - "LINUX_IMMUTABLE"
      - "MAC_ADMIN"
      - "MAC_OVERRIDE"
      - "NET_ADMIN"
      - "NET_BROADCAST"
      - "SYSLOG"
      - "SYS_ADMIN"
      - "SYS_BOOT"
      - "SYS_MODULE"
      - "SYS_NICE"
      - "SYS_PACCT"
      - "SYS_PTRACE"
      - "SYS_RAWIO"
      - "SYS_RESOURCE"
      - "SYS_TIME"
      - "SYS_TTY_CONFIG"
      - "WAKE_ALARM"
    image: prodrigestivill/postgres-backup-local
    container_name: "postgresql_backup"
    restart: always
    user: postgres:postgres
    volumes:
        - nas_backups_databases:/backups
    environment:
        - POSTGRES_HOST=${HOST}
        - POSTGRES_DB=${DATABASES}
        - POSTGRES_USER=${USERNAME}
        - POSTGRES_PASSWORD=${PASSWORD}
        - POSTGRES_EXTRA_OPTS=-Z6 --schema=public --blobs
        - SCHEDULE=@daily
        - BACKUP_KEEP_DAYS=5
        - BACKUP_KEEP_WEEKS=0
        - BACKUP_KEEP_MONTHS=0
        - HEALTHCHECK_PORT=8080
volumes:
  nas_backups_databases:
    external: true